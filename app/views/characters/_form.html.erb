<%= javascript_include_tag "standalone/character-creation.js" %>

<%= simple_form_for @character do |f| %>
  <%= f.input :role_id, as: :hidden %>
  <%= f.input :sex, collection: {"Male" => "male", "Female" => "female"}, include_blank: false %>
  <%= f.input :handle %> <%= link_to "random!", random_name_characters_path, id: "random-name-button" %> <%= link_to "name generator", "http://donjon.bin.sh/scifi/name/#cyberpunk", target: "_blank" %>
  <h2>Statistics <%= link_to image_tag("roll.png"), "#roll", data: { roll: "stats" } %></h2>
  <ul class="editable-stats">
    <% Character::BASIC_ATTRIBUTES.each do |stat| %>
      <li class="editable-stat"><%= f.input stat, as: :integer %></li>
    <% end %>
  </ul>
  <h2>Lifepath</h2>
  <h3>Origins and Personal Style <%= link_to image_tag("roll.png"), "#roll", data: { roll: "style" } %></h3>
  <p>What do you look like and where do you come from?</p>
  <%= f.input :clothes %>
  <%= f.input :hair %>
  <%= f.input :affections %>
  <%= f.input :ethnicity %>
  <%= f.input :language %>
  <h3>Family Background <%= link_to image_tag("roll.png"), "#roll", data: { roll: "family" } %></h3>
  <%= f.input :family_ranking %>
  <%= f.input :parents %>
  <%= f.input :family_status %>
  <%= f.input :childhood_environment %>
  <div class="siblings">
  </div>
  <h3>Life Events <%= link_to image_tag("roll.png"), "#roll", data: { roll: "events" } %></h3>
  <%= f.input :age %>
  <div class="life-events">
  </div>
  <h2>Skills</h2>
  <div id="career-points-left-box">
    <label for="career-points-left">Career Skill Points Left</label>
    <output id="career-points-left"></output>
  </div>
  <div id="pickup-points-left-box">
    <label for="pickup-points-left">Pickup Skill Points Left</label>
    <output id="pickup-points-left"></output>
  </div>
  <div id="pickup-skills" style="display:none">
    <% Skill.where(:_id.nin => @character.role.career_skill_ids).group_by(&:stat).each do |stat, skills| %>
      <% next unless stat %>
      <h3><%= Character.human_attribute_name(stat) %></h3>
      <ul class="pickup-skills <%= stat %>">
        <% skills.each do |skill| %>
          <% skill_data = { name: skill.name, stat: skill.stat, ip_multiplier: skill.ip_multiplier, special_ability: skill.special_ability } %>
          <li class="pickup-skill">
            <%= skill.name %>
            (
            <%= link_to "add as pickup", "#", class: "add-pickup-skill", data: skill_data %>
            |
            <%= link_to "add as chip", "#", class: "add-chip-skill", data: skill_data %>
            )
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
  <%= link_to "Add Skills", "#pickup-skills", id: "add-pickup-skill-button" %>
  <%= f.fields_for :skills do |skill_form| %>
    <% career_skill = @character.role.career_skills.collect(&:name).include?(skill_form.object.name) %>
    <%= skill_form.input :id, as: :hidden if skill_form.object.persisted? %>
    <%= skill_form.input :value, as: :integer, label: skill_form.object.name, wrapper_html: { class: "skill-input #{'career' if career_skill}", style: "display: none;", data: { stat: skill_form.object.stat }, components: [:label_input,:placeholder] } %>
    <%= skill_form.input :name, as: :hidden %>
    <%= skill_form.input :stat, as: :hidden %>
    <%= skill_form.input :custom, as: :hidden %>
    <%= skill_form.input :custom_description, as: :hidden %>
    <%= skill_form.input :ip_multiplier, as: :hidden %>
    <%= skill_form.input :type, as: :hidden %>
    <%= skill_form.input :special_ability, as: :hidden %>
  <% end %>
  <div id="skill-boxes">
    <% Skill.distinct(:stat).each do |stat| %>
      <div class="skill-list-box">
        <h3><%= Character.human_attribute_name(stat) %></h3>
        <div class="skill-list <%= stat %>"></div>
      </div>
    <% end %>
  </div>
  <div class="clear"></div>
  <%= f.button :submit %>
<% end %>
